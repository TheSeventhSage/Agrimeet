import{a as T,b as B,r as s,d as b,j as e,k as F,e as K}from"./index-BOLkSH9S.js";import{D as N}from"./DashboardLayout-BvCakflT.js";import{I as m}from"./Input-gDbNO7ZY.js";import{S as M}from"./Select-BjKnig4G.js";import{B as C}from"./Button-DPYyXRjf.js";import{C as O}from"./ConfirmationModal-cvEjaG2Q.js";import{g as G}from"./skuGenerator-CV7WoRSP.js";import{k as H,b as Q,l as Y}from"./productsApi-Binhdwhq.js";import{A as z}from"./arrow-left-Cgff3Zyj.js";import{S as J}from"./save-C2XOQisP.js";import"./Logo-g0xKsfJ_.js";import"./x-C2LEswAj.js";import"./createLucideIcon-Df3o3GTg.js";import"./package-CKJSu7qp.js";import"./house-CbQ0kLy2.js";import"./users-B4SWA-Gw.js";import"./file-check-CwXOnyIx.js";import"./shield-check-BosUqYmL.js";import"./circle-question-mark-CVrBAAd0.js";import"./star-C1ESBnNj.js";import"./message-circle-BHYE61eq.js";import"./file-text-CticlOFV.js";import"./user-CozA4sKy.js";import"./BackgroundArt-ChQV54k0.js";const fe=()=>{const{productId:p,variantId:x}=T(),l=B(),[a,f]=s.useState({name:"",sku:"",price:"",stock_quantity:"",unit_id:""}),[u,j]=s.useState({id:"",name:"",value:""}),[n,v]=s.useState({}),[S,k]=s.useState(!1),[w,y]=s.useState(!1),[V,E]=s.useState([]),[D,_]=s.useState(!0),[o,I]=s.useState(null);s.useEffect(()=>{if(!p||!x){b("Invalid product or variant ID"),l("/products");return}L()},[p,x,l]);const L=async()=>{try{_(!0);const[t,r]=await Promise.all([H(p,x),Q()]),i=t.data||t;E(r.data||[]);const d={name:i.name||"",sku:i.sku||"",price:String(i.price||""),stock_quantity:String(i.stock_quantity||""),unit_id:String(i.unit_id||"")};f(d);let c={id:"",name:"",value:""};if(i.attribute_values&&i.attribute_values.length>0){const h=i.attribute_values[0];h&&(c={id:h.attribute_id,name:h.attribute?.name||"Attribute",value:h.value})}j(c),I({...d,attributeValue:c.value})}catch(t){console.error("Error loading variant:",t),b("Failed to load variant data. Please try again.")}finally{_(!1)}},g=t=>{const{name:r,value:i}=t.target;f(d=>{const c={...d,[r]:i};return r==="name"&&(c.sku=G(i)),c}),n[r]&&v(d=>({...d,[r]:""}))},U=t=>{j(r=>({...r,value:t.target.value})),n.attribute_value&&v(r=>({...r,attribute_value:""}))},A=()=>{const t={};return a.name.trim()||(t.name="Variant name is required"),a.sku.trim()||(t.sku="SKU is required"),(!a.price||a.price<=0)&&(t.price="Valid price is required"),(!a.stock_quantity||a.stock_quantity<0)&&(t.stock_quantity="Valid stock quantity is required"),a.unit_id||(t.unit_id="Unit is required"),u.value.toString().trim()||(t.attribute_value="Attribute value is required"),v(t),Object.keys(t).length===0},P=async t=>{if(t.preventDefault(),!!A()){k(!0);try{const r={...a,attributes:[{attribute_id:u.id,value:u.value}]},i=await Y(p,x,r);K(i.message||"Variant updated successfully!"),l("/products")}catch(r){console.error("Error updating variant:",r),r.message.includes("Session expired")?(b("Session expired. Please login again."),l("/login")):b(r.message||"Error updating variant. Please try again.")}finally{k(!1)}}},q=()=>{o&&(a.name!==o.name||a.sku!==o.sku||a.price!==o.price||a.stock_quantity!==o.stock_quantity||a.unit_id!==o.unit_id||u.value!==o.attributeValue)?y(!0):l("/products")},R=()=>{y(!1),l("/products")};return D?e.jsx(N,{children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{}),e.jsx("p",{className:"text-gray-600",children:"Loading Variety data..."})]})})})}):e.jsx(N,{children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:q,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(z,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Edit Product Variety"}),e.jsxs("p",{className:"text-gray-600",children:["Update variety for product ID: ",p]})]})]})}),e.jsxs("form",{onSubmit:P,className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Variety Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(m,{label:"Variety Name",name:"name",value:a.name,onChange:g,placeholder:"e.g., Large Red T-Shirt",error:n.name,required:!0}),e.jsx(m,{label:"SKU",name:"sku",value:a.sku,onChange:g,placeholder:"e.g., TSH-LRG-RED-001",error:n.sku,required:!0}),e.jsx(m,{label:"Price",name:"price",type:"number",value:a.price,onChange:g,placeholder:"Enter price",error:n.price,required:!0,min:"0",step:"0.01"}),e.jsx(m,{label:"Stock Quantity",name:"stock_quantity",type:"number",value:a.stock_quantity,onChange:g,placeholder:"Enter stock quantity",error:n.stock_quantity,required:!0,min:"0"}),e.jsx(M,{label:"Unit",name:"unit_id",value:a.unit_id,onChange:g,options:V.map(t=>({value:String(t.id),label:t.name})),placeholder:"Select unit",error:n.unit_id,required:!0})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Attribute"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(m,{label:"Attribute Type",value:u.name||"Loading...",disabled:!0,className:"bg-gray-100 text-gray-700 cursor-not-allowed"}),e.jsx(m,{label:"Value",value:u.value,onChange:U,placeholder:"Enter value",error:n.attribute_value,required:!0})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-6 border-t border-gray-200",children:[e.jsx(C,{type:"button",onClick:q,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs(C,{type:"submit",loading:S,className:"px-6 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),S?"Updating...":"Update Variety"]})]})]}),e.jsx(O,{isOpen:w,onClose:()=>y(!1),onConfirm:R,title:"Cancel Variety Edit",message:"You have unsaved changes. Are you sure you want to leave?",confirmText:"Leave",cancelText:"Continue Editing",type:"warning"})]})})};export{fe as default};
