import{r as c,j as a,f as v,s as w,d as l,g as E,e as D}from"./index-BrJE6Ruv.js";import{A as N}from"./AuthLayout-Q1YB1LSm.js";import{B as P}from"./Button-NP5qGopO.js";import{o as S}from"./validation-BVSLfvBr.js";import{a as V}from"./routingManager-C4lI7ZM2.js";import"./Logo-yv9J0Zw_.js";import"./BackgroundArt-Cv4ql44m.js";import"./house-B5NBqIRK.js";import"./createLucideIcon-DTbf89oH.js";function k({length:n=6,value:d="",onChange:o}){const t=c.useRef([]),g=(s,e)=>{const r=d.split("");r[s]=e.replace(/\D/g,"").slice(-1)||"";const y=r.join("").padEnd(n,"");o(y),e&&s<n-1&&t.current[s+1]?.focus()},f=(s,e)=>{s.key==="Backspace"&&!d[e]&&e>0&&t.current[e-1]?.focus(),s.key==="ArrowLeft"&&e>0&&t.current[e-1]?.focus(),s.key==="ArrowRight"&&e<n-1&&t.current[e+1]?.focus()},m=s=>{const e=(s.clipboardData.getData("text")||"").replace(/\D/g,"").slice(0,n);if(e){s.preventDefault();const r=e.padEnd(n,"");o(r),t.current[Math.min(e.length,n)-1]?.focus()}};return a.jsx("div",{className:"flex gap-2 justify-center",onPaste:m,children:Array.from({length:n}).map((s,e)=>a.jsx("input",{inputMode:"numeric",value:d[e]||"",onChange:r=>g(e,r.target.value),onKeyDown:r=>f(r,e),ref:r=>t.current[e]=r,className:"md:w-12 md:h-12 w-10 h-10 text-center text-lg font-medium rounded-xl border border-gray-200 focus:ring-2 focus:ring-gray-900/20 focus:border-gray-900/40 outline-hidden"},e))})}function K(){const[n,d]=c.useState(""),[o,t]=c.useState({}),[g,f]=c.useState(!1),[m,s]=c.useState(!1),[e,r]=c.useState(""),{user:y,verifyOtp:x}=v();c.useEffect(()=>{const i=w.getUserData();i?.email&&r(i.email)},[]);const h=e||y?.email||"your email",j=async i=>{i.preventDefault();const p=S(n);if(Object.keys(p).length>0){t(p),l("Please enter a valid verification code");return}f(!0),t({});try{await x({email:h,verification_code:n}),V()}catch(u){u.errors?(t(u.errors),l("Verification failed. Please check the code and try again.")):u.message?(t({general:u.message}),l(u.message)):(t({general:"Invalid verification code. Please try again."}),l("Invalid verification code. Please try again."))}finally{f(!1)}},b=async()=>{s(!0),t({});try{await E.resendOtp(h),t({success:"Verification code sent successfully!"}),D("Verification code sent successfully!")}catch(i){i.message?(t({general:i.message}),l(i.message)):(t({general:"Failed to resend code. Please try again."}),l("Failed to resend code. Please try again."))}finally{s(!1)}};return a.jsx(N,{title:"Verify your account",subtitle:`Enter the 6-digit code sent to ${h}`,footer:a.jsxs("p",{children:["Didn't get it?"," ",a.jsx("button",{type:"button",className:"font-medium hover:underline text-brand-600 disabled:opacity-50",onClick:b,disabled:m,children:m?"Sending...":"Resend code"})]}),children:a.jsxs("form",{onSubmit:j,className:"space-y-6",children:[o.general&&a.jsx("div",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:o.general}),o.success&&a.jsx("div",{className:"text-sm text-green-600 bg-green-50 p-3 rounded-lg",children:o.success}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(k,{length:6,value:n,onChange:i=>{d(i),o.otp&&t(p=>({...p,otp:""}))}}),o.otp&&a.jsx("p",{className:"text-sm text-red-600",children:o.otp})]}),a.jsx(P,{type:"submit",loading:g,className:"w-full",children:"Verify & Continue"}),a.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Tip: you can paste the entire code; inputs will auto-fill and advance."})]})})}export{K as default};
