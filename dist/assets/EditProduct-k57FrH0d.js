import{a as ie,b as oe,r as c,j as e,d as w,e as ne}from"./index-C7G52Pl0.js";import{D as B}from"./DashboardLayout-BvYMyTkM.js";import{I as m}from"./Input-CoWmPaz6.js";import{S as N}from"./Select-DuleQLu3.js";import{T as ce}from"./Textarea-CO9hTvsh.js";import{B as C}from"./Button-rTuh0BPh.js";import{C as le}from"./ConfirmationModal-SSmu3Mbo.js";import{D as $}from"./DocumentUpload-uXsnAHBP.js";import{g as de}from"./skuGenerator-CV7WoRSP.js";import{h as ue,a as pe,b as me,u as ge}from"./productsApi-i5zjMZO3.js";import{A as he}from"./arrow-left-Crwr5rsD.js";import{T as xe}from"./trash-2-yhPGZUjZ.js";import{P as be}from"./package-DupdcTls.js";import{S as fe}from"./save-CmqQsiC0.js";import"./Logo-DmsMbJO2.js";import"./x-B7cmv6PP.js";import"./createLucideIcon-BK9ndVRo.js";import"./house-D2YIMOjc.js";import"./users-BmFRYmpR.js";import"./file-check-CHEU1kxb.js";import"./shield-check-DG8ZUOrZ.js";import"./circle-question-mark-DtC5Y68d.js";import"./star-C80gymXW.js";import"./message-circle-CLbYCCGy.js";import"./file-text-XKYnme41.js";import"./user-CwMqLLM3.js";import"./BackgroundArt-Ct9Pe-Iv.js";const Ke=()=>{const{id:x}=ie(),b=oe(),[t,S]=c.useState({name:"",sku:"",weight:"",slug:"",description:"",base_price:"",discount_price:"",stock_quantity:"",status:"active",category_id:"",unit_id:""}),[_,M]=c.useState([]),[y,A]=c.useState([]),[g,k]=c.useState([]),[o,q]=c.useState({}),[P,E]=c.useState(!1),[G,I]=c.useState(!0),[L,j]=c.useState(!1),[d,R]=c.useState(null),[V,J]=c.useState([]),[K,W]=c.useState([]);c.useEffect(()=>{(async()=>{if(!x){w("Product ID not found"),b("/products");return}try{I(!0);const[a,n,i]=await Promise.all([ue(x),pe(),me()]),r=a?.data||a?.product||a,h=n?.data||[],ae=i.data||[];J(h),W(ae);const T=(u,f)=>{if(!f)return"";for(const p of u){if(p.name===f)return String(p.id);if(p.children&&p.children.length>0){const O=T(p.children,f);if(O)return O}}return""};let v="";typeof r.category=="string"?v=T(h,r.category):r.category?.id?v=String(r.category.id):r.category_id&&(v=String(r.category_id));const F={name:r?.name||"",sku:r?.sku||"",weight:r?.weight?String(r.weight):"",slug:r?.slug||"",description:r?.description||"",base_price:r?.base_price?String(r.base_price):"",discount_price:r?.discount_price?String(r.discount_price):"",stock_quantity:r?.stock_quantity?String(r.stock_quantity):"",status:r?.status||"active",category_id:v,unit_id:r?.unit?.id?String(r.unit.id):r?.unit_id?String(r.unit_id):""};S(F),R(F);const se=(r?.images||[]).map((u,f)=>{const p=typeof u=="string"?u:u.url?.startsWith("http")?u.url:`https://agrimeet.udehcoglobalfoodsltd.com/storage/${u.url}`;return{id:`existing-${f}-${Date.now()}`,url:p}});k(se)}catch(a){console.error("Error loading product:",a),w(a.message||"Failed to load product data")}finally{I(!1)}})()},[x]);const l=s=>{const{name:a,value:n}=s.target;S(i=>{const r={...i,[a]:n};return a==="name"&&(r.sku=de(n)),r}),o[a]&&q(i=>({...i,[a]:""}))},Q=s=>{M(s)},Y=s=>{A(s)},z=s=>{k(a=>a.filter(n=>n.id!==s))},H=()=>{const s={};return t.name.trim()||(s.name="Product name is required"),t.description.trim()||(s.description="Description is required"),(!t.base_price||Number(t.base_price)<=0)&&(s.base_price="Valid base price is required"),t.category_id||(s.category_id="Category is required"),t.unit_id||(s.unit_id="Unit is required"),(!t.stock_quantity||Number(t.stock_quantity)<0)&&(s.stock_quantity="Valid stock quantity is required"),g.length===0&&_.length===0&&y.length===0&&(s.images="Provide at least one image (thumbnail or additional)"),q(s),Object.keys(s).length===0},X=async(s,a,n)=>{try{const i=await fetch(s,{mode:"cors",credentials:"omit"});if(!i.ok)throw new Error("Network response was not ok");const r=await i.blob();return new File([r],a,{type:n||r.type})}catch(i){return console.error(`Error converting ${s} to file. This is likely a CORS issue.`,i),null}},D=(s,a=0)=>{let n=[];return s&&s.forEach(i=>{const r=a>0?"  ".repeat(a)+"- ":"";n.push({value:String(i.id),label:`${r}${i.name}`}),i.children&&i.children.length>0&&(n=[...n,...D(i.children,a+1)])}),n},Z=D(V),ee=async s=>{if(s.preventDefault(),!!H()){E(!0);try{const a=new FormData;if(a.append("name",t.name),t.sku&&a.append("sku",t.sku),t.weight&&a.append("weight",t.weight),t.slug&&a.append("slug",t.slug),a.append("description",t.description),a.append("base_price",t.base_price),t.discount_price&&a.append("discount_price",t.discount_price),a.append("stock_quantity",t.stock_quantity),a.append("status",t.status),a.append("category_id",t.category_id),a.append("unit_id",t.unit_id),a.append("_method","PUT"),y.length>0){const r=y[0].file||y[0];a.append("thumbnail",r)}(await Promise.all(g.map(async(r,h)=>await X(r.url,`existing-${h}.jpg`,"image/jpeg")))).forEach(r=>{r&&a.append("images[]",r)}),_.forEach(r=>{const h=r.file||r;a.append("images[]",h)});const i=await ge(x,a);ne(i?.message||"Product updated successfully!"),b("/products")}catch(a){console.error("Error updating product:",a),w(a.message||"Error updating product. Please try again.")}finally{E(!1)}}},te=()=>{b(`/products/${x}/variants`)},U=()=>{d&&(t.name!==d.name||t.sku!==d.sku||t.weight!==d.weight||t.description!==d.description||t.base_price!==d.base_price||t.discount_price!==d.discount_price||t.category_id!==d.category_id||t.stock_quantity!==d.stock_quantity||_.length>0||g.length!==(d.images?.length||0))?j(!0):b("/products")},re=()=>{j(!1),b("/products")};return G?e.jsx(B,{children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading product data..."})]})})})}):e.jsx(B,{children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:U,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(he,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Edit Product"}),e.jsx("p",{className:"text-gray-600",children:"Update your product information"})]})]})}),e.jsxs("form",{onSubmit:ee,className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(m,{label:"Product Name",name:"name",value:t.name,onChange:l,placeholder:"Enter product name",error:o.name,required:!0}),e.jsx(m,{label:"SKU",name:"sku",value:t.sku,onChange:l,placeholder:"e.g. PROD-001",error:o.sku}),e.jsx(m,{label:"Slug (Optional)",name:"slug",value:t.slug,onChange:l,placeholder:"product-slug (auto-generated if empty)",error:o.slug}),e.jsx(N,{label:"Category",name:"category_id",value:t.category_id,onChange:l,options:Z,placeholder:"Select category",error:o.category_id,required:!0}),e.jsx(m,{label:"Stock Quantity",name:"stock_quantity",type:"number",value:t.stock_quantity,onChange:l,placeholder:"Enter stock quantity",error:o.stock_quantity,required:!0,min:"0"}),e.jsx(N,{label:"Unit",name:"unit_id",value:t.unit_id,onChange:l,options:K.map(s=>({value:String(s.id),label:s.name})),placeholder:"Select unit",error:o.unit_id,required:!0}),e.jsx(N,{label:"Status",name:"status",value:t.status,onChange:l,options:[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"},{value:"draft",label:"Draft"}],placeholder:"Select status",error:o.status,required:!0}),e.jsx(m,{label:"Weight",name:"weight",type:"number",value:t.weight,onChange:l,placeholder:"Enter weight (e.g. 0.5)",error:o.weight,min:"0",step:"0.01"})]}),e.jsx("div",{className:"mt-6",children:e.jsx(ce,{label:"Description",name:"description",value:t.description,onChange:l,placeholder:"Enter product description",error:o.description,required:!0,rows:4})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Pricing"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(m,{label:"Base Price",name:"base_price",type:"number",value:t.base_price,onChange:l,placeholder:"Enter base price",error:o.base_price,required:!0,min:"0",step:"0.01"}),e.jsx(m,{label:"Discount Price (Optional)",name:"discount_price",type:"number",value:t.discount_price,onChange:l,placeholder:"Enter discount price",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Product Images"}),g.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-4",children:["Current Images (",g.length,")"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:g.map(s=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:s.url,alt:"Product",className:"w-full h-24 object-cover rounded-lg"}),e.jsx("button",{type:"button",onClick:()=>z(s.id),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(xe,{className:"w-3 h-3"})})]},s.id))})]}),e.jsx($,{label:"Product Thumbnail (optional)",onChange:Y,error:o.thumbnail,multiple:!1,maxFiles:1,helperText:"PNG, JPG, GIF up to 10MB"}),e.jsx($,{label:"Add New Images (optional)",onChange:Q,error:o.images,multiple:!0,maxFiles:10,helperText:"PNG, JPG, GIF up to 10MB each"}),o.images&&e.jsx("p",{className:"text-sm text-red-600 mt-2",children:o.images})]}),e.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200",children:[e.jsxs(C,{type:"button",onClick:te,className:"px-6 py-2 border border-purple-500 text-purple-600 rounded-lg hover:bg-purple-50 transition-colors flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),"Manage Variants"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{type:"button",onClick:U,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs(C,{type:"submit",loading:P,className:"px-6 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),P?"Updating...":"Update Product"]})]})]})]}),e.jsx(le,{isOpen:L,onClose:()=>j(!1),onConfirm:re,title:"Cancel Product Edit",message:"You have unsaved changes. Are you sure you want to leave? All your changes will be lost.",confirmText:"Leave",cancelText:"Continue Editing",type:"warning"})]})})};export{Ke as default};
