import{j as e,b as F,r as x,h as V,d as C,e as R}from"./index-BOLkSH9S.js";import{P as B,E as H,D as O}from"./DashboardLayout-BvCakflT.js";import{S as q}from"./search-Ckn77Lrt.js";import{S as U}from"./square-pen-0mVU6Zf5.js";import{P as A,C as G}from"./package-CKJSu7qp.js";import{T as Y}from"./trash-2-Euhy1XCH.js";import{C as Z}from"./ConfirmationModal-cvEjaG2Q.js";import{C as z}from"./chevron-left-B0iQB9Pm.js";import{g as P,t as k,d as J}from"./productsApi-Binhdwhq.js";import"./Logo-g0xKsfJ_.js";import"./x-C2LEswAj.js";import"./createLucideIcon-Df3o3GTg.js";import"./house-CbQ0kLy2.js";import"./users-B4SWA-Gw.js";import"./file-check-CwXOnyIx.js";import"./shield-check-BosUqYmL.js";import"./circle-question-mark-CVrBAAd0.js";import"./star-C1ESBnNj.js";import"./message-circle-BHYE61eq.js";import"./file-text-CticlOFV.js";import"./user-CozA4sKy.js";import"./BackgroundArt-ChQV54k0.js";const K=({onAddProduct:t,totalProducts:r=0,searchTerm:o,onSearchChange:d,statusFilter:h,onStatusChange:c})=>e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-start lg:items-center justify-between lg:flex-row flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"AGRICULTURAL PRODUCTS"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{children:"Dashboard"}),e.jsx("span",{children:"›"}),e.jsx("span",{children:"Products"}),e.jsx("span",{children:"›"}),e.jsx("span",{children:"All Products"})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors",children:[e.jsx(B,{className:"w-4 h-4"}),"New Product"]})})]}),e.jsxs("div",{className:"flex flex-col justify-between mt-6 gap-4 md:items-center md:flex-row",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx("input",{type:"text",placeholder:"Search by product name...",value:o,onChange:i=>d(i.target.value),className:"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500"}),e.jsx(q,{className:"w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"})]}),e.jsx("div",{className:"relative w-full",children:e.jsxs("select",{value:h,onChange:i=>c(i.target.value),className:"w-full px-4 py-2 text-sm border border-gray-300 rounded-lg appearance-none focus:outline-none focus:ring-2 focus:ring-brand-500 bg-white",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})})]}),e.jsxs("p",{className:"text-sm text-gray-600 flex-shrink-0",children:["Showing ",e.jsx("strong",{children:r})," total products"]})]})]}),Q=({product:t,onEdit:r,onDelete:o,onView:d,onManageVariants:h,isDeleting:c=!1})=>{const i=t?.image||t?.thumbnail||Array.isArray(t?.images)&&t.images[0]||"",j=Array.isArray(t?.variants)?t.variants.reduce((l,n)=>l+(Number(n?.stock_quantity??n?.stock??0)||0),0):0,a=(Number(t?.stock??t?.stock_quantity??0)||0)+j,p=({status:l})=>{const n={active:{bg:"bg-green-100",text:"text-green-800",label:"Active"},inactive:{bg:"bg-red-100",text:"text-red-800",label:"Inactive"},draft:{bg:"bg-gray-100",text:"text-gray-800",label:"Draft"},pending:{bg:"bg-yellow-100",text:"text-yellow-800",label:"Pending"}},m=n[(l||"").toLowerCase()]||n.draft;return e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${m.bg} ${m.text}`,children:m.label})},f=({stock:l})=>{let n;return l>50?n={bg:"bg-green-100",text:"text-green-800",label:"In Stock"}:l>10?n={bg:"bg-yellow-100",text:"text-yellow-800",label:"Low Stock"}:l>0?n={bg:"bg-orange-100",text:"text-orange-800",label:"Very Low"}:n={bg:"bg-red-100",text:"text-red-800",label:"Out of Stock"},e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-900 text-sm",children:l}),e.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-xs font-medium ${n.bg} ${n.text}`,children:n.label})]})},N=l=>{l.target.src=`data:image/svg+xml;base64,${btoa(`
            <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="40" height="40" fill="#f3f4f6"/>
                <path d="M20 10L16 14H12C10.9 14 10 14.9 10 16V26C10 27.1 10.9 28 12 28H28C29.1 28 30 27.1 30 26V16C30 14.9 29.1 14 28 14H24L20 10ZM20 25C17.24 25 15 22.76 15 20C15 17.24 17.24 15 20 15C22.76 15 25 17.24 25 20C25 22.76 22.76 25 20 25Z" fill="#9ca3af"/>
            </svg>
        `)}`};return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors border-b border-gray-100",children:[e.jsx("td",{className:"px-2 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg overflow-hidden bg-gray-100 shrink-0",children:e.jsx("img",{src:i,alt:t?.name,className:"w-full h-full object-cover",onError:N})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm truncate",title:t?.name,children:t?.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate",title:t?.description,children:t?.description||"No description"}),t?.slug&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Slug: ",t.slug]}),Array.isArray(t?.variants)&&t.variants.length>0&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[t.variants.length," variet",t.variants.length>1?"ies":"y"]})]})]})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:t?.category??"—"})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-semibold text-gray-900 text-sm",children:["$",t?.discountedPrice??t?.price??t?.discount_price??t?.base_price]}),t?.unit&&e.jsxs("span",{className:"text-xs text-gray-500",children:["/",t?.unitSymbol??t?.unit?.symbol??t?.unit]})]}),t?.originalPrice&&t?.originalPrice>(t?.discountedPrice??t?.price)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500 line-through",children:["$",t.originalPrice]}),e.jsxs("span",{className:"text-xs font-medium text-green-600",children:["(",t.discount,"% off)"]})]})]})}),e.jsx("td",{className:"px-2 py-3 w-fit",children:e.jsx(f,{stock:a})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx(p,{status:t?.status})}),e.jsx("td",{className:"px-3 py-3",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>d&&d(t),className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"View Product",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>r&&r(t),className:"p-1.5 text-blue-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Edit Product",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>h&&h(t),className:"p-1.5 text-purple-400 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors",title:"Manage Varieties",children:e.jsx(A,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>o&&o(t),disabled:c,className:"p-1.5 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete Product",children:c?e.jsx("div",{className:"w-4 h-4 animate-spin rounded-full border-2 border-red-300 border-t-red-600"}):e.jsx(Y,{className:"w-4 h-4"})})]})})]})},W=({currentPage:t,lastPage:r,onPageChange:o})=>{const d=[];let c,i;if(r<=5)c=1,i=r;else{const a=Math.floor(2.5),p=Math.ceil(5/2)-1;t<=a?(c=1,i=5):t+p>=r?(c=r-5+1,i=r):(c=t-a,i=t+p)}for(let a=c;a<=i;a++)d.push(a);const j=c>1,y=i<r;return e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-200 bg-white rounded-b-xl",children:[e.jsxs("button",{onClick:()=>o(t-1),disabled:t===1,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 border border-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors",children:[e.jsx(z,{className:"w-4 h-4"}),"Previous"]}),e.jsxs("nav",{className:"hidden md:flex items-center gap-2",children:[j&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>o(1),className:"px-3 py-1 text-sm rounded-md hover:bg-gray-100",children:"1"}),e.jsx("span",{className:"px-3 py-1 text-sm text-gray-500",children:"..."})]}),d.map(a=>e.jsx("button",{onClick:()=>o(a),className:`px-3 py-1 text-sm rounded-md transition-colors ${t===a?"bg-brand-500 text-white font-semibold":"text-gray-700 hover:bg-gray-100"}`,children:a},a)),y&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"px-3 py-1 text-sm text-gray-500",children:"..."}),e.jsx("button",{onClick:()=>o(r),className:"px-3 py-1 text-sm rounded-md hover:bg-gray-100",children:r})]})]}),e.jsxs("button",{onClick:()=>o(t+1),disabled:t===r,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 border border-gray-300 rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors",children:["Next",e.jsx(G,{className:"w-4 h-4"})]})]})};function ve(){const t=F(),[r,o]=x.useState([]),[d,h]=x.useState(!0),[c,i]=x.useState(null),[j,y]=x.useState(!1),[a,p]=x.useState(null),[f,N]=x.useState(1),[l,n]=x.useState({current_page:1,last_page:1,total:0}),[m,T]=x.useState(""),[b,_]=x.useState("all");x.useEffect(()=>{(async()=>{h(!0);try{const g=await P(f),u=g.data,v=g.meta;if(!u||!v)throw new Error("Invalid API response structure");o(u.map(k)),n({current_page:v.current_page,last_page:v.last_page,total:v.total})}catch(g){C("Failed to fetch products",g.message)}finally{h(!1)}})()},[f]);const w=x.useMemo(()=>r.filter(s=>{const g=s.name.toLowerCase().includes(m.toLowerCase()),u=s.is_published?"active":"inactive";return g&&(b==="all"||u===b)}),[r,m,b]),S=()=>t("/products/add"),L=s=>t(`/products/edit/${s.id}`),D=s=>t(`/products/${s.id}`),E=s=>t(`/products/${s.id}/variants`),M=s=>{p(s),y(!0)},$=async()=>{if(a){y(!1),i(a.id);try{await J(a.id),R("Product deleted successfully");const s=await P(f),{data:g,meta:u}=s;o(g.map(k)),n({current_page:u.current_page,last_page:u.last_page,total:u.total}),g.length===0&&f>1&&N(f-1)}catch(s){C("Failed to delete product",s.message)}finally{i(null),p(null)}}},I=s=>{s>0&&s<=l.last_page&&N(s)};return e.jsxs(O,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(K,{onAddProduct:S,totalProducts:l.total,searchTerm:m,onSearchChange:T,statusFilter:b,onStatusChange:_}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-[800px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-gray-50",children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Price"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{className:"px-5 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:!d&&w.length>0&&w.map(s=>e.jsx(Q,{product:s,onEdit:L,onDelete:M,onView:D,onManageVariants:E,isDeleting:c===s.id},s.id))})]})}),d&&e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx(V,{size:"lg",message:"Loading products..."})}),!d&&w.length===0&&e.jsxs("div",{className:"text-center p-12",children:[e.jsx(A,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:m||b!=="all"?"No Products Match Filters":"No Products Found"}),e.jsx("p",{className:"text-gray-500 mb-6",children:m||b!=="all"?"Try adjusting your search or filters.":"You haven't added any products yet."}),!(m||b!=="all")&&e.jsx("button",{onClick:S,className:"px-6 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors",children:"Add Your First Product"})]})]}),!d&&l.last_page>1&&e.jsx(W,{currentPage:l.current_page,lastPage:l.last_page,onPageChange:I})]}),e.jsx(Z,{isOpen:j,onClose:()=>y(!1),onConfirm:$,title:"Delete Product",message:`Are you sure you want to delete "${a?.name}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",type:"danger"})]})}export{ve as default};
