import{s as y,f as z,b as V,r as l,j as e,P as B,h as p,d as M}from"./index-BOLkSH9S.js";import{S as f,D as q,P as F,E as G}from"./DashboardLayout-BvCakflT.js";import{B as H}from"./Button-DPYyXRjf.js";import{N as J}from"./Currency-D4jQjH5o.js";import{P as S}from"./package-CKJSu7qp.js";import{U as K}from"./users-B4SWA-Gw.js";import{A as Q}from"./arrow-up-right-o1Zno_gf.js";import{S as X}from"./star-C1ESBnNj.js";import{C as P}from"./credit-card-ZC6Uwims.js";import"./Logo-g0xKsfJ_.js";import"./x-C2LEswAj.js";import"./createLucideIcon-Df3o3GTg.js";import"./house-CbQ0kLy2.js";import"./file-check-CwXOnyIx.js";import"./shield-check-BosUqYmL.js";import"./circle-question-mark-CVrBAAd0.js";import"./message-circle-BHYE61eq.js";import"./file-text-CticlOFV.js";import"./user-CozA4sKy.js";import"./BackgroundArt-ChQV54k0.js";const Y="https://agrimeetbackend.agrimeetconnect.com/api/v1",c=async(t,d={})=>{const r=y.getAccessToken();if(!r)throw new Error("Authentication token not found.");const o=await fetch(`${Y}${t}`,{method:d.method||"GET",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json",Accept:"application/json",...d.headers},body:d.body||null});if(!o.ok){const x=await o.json().catch(()=>({message:"API request failed"}));throw new Error(x.message||`API request failed with status ${o.status}`)}return o.json()},Z=()=>c("/seller/vendor_stats"),ee=()=>c("/seller/top_weekly_products"),se=()=>c("/seller/recent_weekly_orders"),te=()=>c("/seller/top_weekly_transactions"),re=t=>t?c(`/buyer/users/${t}`):Promise.reject(new Error("User ID is required to fetch profile.")),ae=t=>c("/seller/kyc/validate-seller-address",{method:"POST",body:JSON.stringify({seller_id:t})}),j=t=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",notation:"compact",maximumFractionDigits:1,minimumFractionDigits:0}).format(t),le=t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),D=t=>{switch(t?.toLowerCase()){case"paid":case"fulfilled":case"completed":return"bg-green-100 text-green-800";case"unpaid":case"unfulfilled":case"pending":return"bg-yellow-100 text-yellow-800";case"shipped":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},Se=()=>{const{user:t}=z(),d=V(),[r,o]=l.useState(null),[x,T]=l.useState([]),[b,A]=l.useState([]),[N,C]=l.useState([]),[E,L]=l.useState(!0),[m,I]=l.useState(()=>y.getUserData()),[h,v]=l.useState({stats:!0,products:!0,orders:!0,transactions:!0});console.log(m),l.useEffect(()=>{const s=t?.user_id||m?.user_id||m?.data?.id;if(!s)return;let i=!0;const O=async()=>{try{v(!0);const a=await re(s).catch(W=>(console.error("Error fetching user profile:",W),null));if(!i)return;if(!a?.data?.seller)throw new Error("Unable to retrieve seller details.");I(a),y.setUserData(a);const n=a.data.seller.id,[u,w,_,k]=await Promise.all([Z().catch(()=>null),ee(n).catch(()=>[]),se(n).catch(()=>[]),te(n).catch(()=>[])]);if(!i)return;u&&o(u),w&&T(w),_&&A(_),k&&C(k),await R(n)}catch(a){console.error("Critical Dashboard Error:",a),i&&M(a.message||"An unexpected error occurred while loading.")}finally{i&&(v({stats:!1,products:!1,orders:!1,transactions:!1}),L(!1))}},R=async a=>{const n=`addr_val_${a}`;if(!localStorage.getItem(n))try{await ae(a),localStorage.setItem(n,"true"),console.log("Address validation synced successfully")}catch(u){console.warn("Address validation failed (non-critical):",u)}};return O(),()=>{i=!1}},[t?.user_id]);const U=[{title:"Total Revenue",value:r?j(r.total_revenue):"...",icon:J,color:"bg-green-500"},{title:"Total Products",value:r?r.total_products:"...",icon:S,color:"bg-brand-500"},{title:"Total Orders",value:r?r.total_orders:"...",icon:f,color:"bg-blue-500"},{title:"Total Reviews",value:r?r.total_reviews:"...",icon:K,color:"bg-purple-500"}];if(E)return e.jsx(B,{message:"Loading your dashboard..."});const $=m?.data?.first_name||t?.name||"User",g=m?.data?.seller?.store_name;return e.jsx(q,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Welcome back, ",$,"!",g&&` Managing ${g}.`,!g&&" Here's what's happening with your agricultural business."]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:U.map((s,i)=>e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 p-6",children:[e.jsx("div",{className:`p-3 rounded-lg w-fit ml-auto ${s.color}`,children:e.jsx(s.icon,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:s.value})]})})]},i))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-xs border border-gray-100",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Weekly Orders"}),e.jsxs(H,{onClick:()=>d("/orders"),className:"text-brand-600 hover:text-brand-700 text-sm font-medium flex items-center gap-1",variant:"ghost",children:["View all ",e.jsx(Q,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"p-6",children:h.orders?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(p,{size:"md",message:"Loading recent orders..."})}):b.length>0?e.jsx("div",{className:"space-y-4",children:b.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:s.products[0]?.thumbnail||"https://via.placeholder.com/40",alt:s.products[0]?.name,className:"w-10 h-10 object-cover rounded-lg bg-gray-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.order_number}),e.jsxs("p",{className:"text-sm text-gray-600",children:["by ",s.user.first_name," ",s.user.last_name]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:j(s.total_amount)}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-1",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${D(s.payment_status)}`,children:s.payment_status}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${D(s.fulfillment_status)}`,children:s.fulfillment_status})]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(f,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No recent orders this week."})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Top Products This Week"})}),e.jsx("div",{className:"p-6",children:h.products?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(p,{size:"md",message:"Loading top products..."})}):x.length>0?e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.product.thumbnail||"https://via.placeholder.com/40",alt:s.product.name,className:"w-10 h-10 object-cover rounded-lg bg-gray-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 truncate max-w-[150px]",children:s.product.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Top Seller"})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-semibold text-gray-900",children:[s.total_sold," sales"]})})]},s.product_id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(S,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No top products found this week."})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Top Weekly Transactions"})}),e.jsx("div",{className:"p-6",children:h.transactions?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(p,{size:"md",message:"Loading transactions..."})}):N.length>0?e.jsx("div",{className:"space-y-4",children:N.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(P,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.order_number}),e.jsxs("p",{className:"text-sm text-gray-600",children:["by ",s.user.first_name," ",s.user.last_name]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-green-600",children:j(s.total_amount)}),e.jsx("p",{className:"text-sm text-gray-500",children:le(s.created_at)})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No transactions found this week."})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:()=>window.location.href="/products/add",className:"cursor-pointer flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"p-2 bg-brand-100 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Add Product"}),e.jsx("p",{className:"text-sm text-gray-600",children:"List a new agricultural product"})]})]}),e.jsxs("button",{onClick:()=>window.location.href="/products",className:"cursor-pointer flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(G,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"View Products"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage your product listings"})]})]}),e.jsxs("button",{onClick:()=>window.location.href="/orders",className:"cursor-pointer flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(f,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"View Orders"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Check order status and details"})]})]})]})]})]})})};export{Se as default};
