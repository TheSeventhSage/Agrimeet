import{j as e,D as p,r as c,d as C}from"./index-C7G52Pl0.js";import{c as k,D,E as O}from"./DashboardLayout-BvYMyTkM.js";import{X as E}from"./x-B7cmv6PP.js";import{T as j}from"./truck-D2GZdSRj.js";import{E as A}from"./external-link-CzbzoJQ_.js";import{P,C as I}from"./package-DupdcTls.js";import{U as h}from"./user-CwMqLLM3.js";import{M as F}from"./map-pin-DB9Cjm-f.js";import{C as L}from"./credit-card-DfSSP4nG.js";import{S as T}from"./shield-DD7_1skf.js";import{C as $}from"./calendar-CiJPG-0y.js";import{C as z}from"./chevron-left-MymTQRW8.js";import"./Logo-DmsMbJO2.js";import"./house-D2YIMOjc.js";import"./createLucideIcon-BK9ndVRo.js";import"./users-BmFRYmpR.js";import"./file-check-CHEU1kxb.js";import"./shield-check-DG8ZUOrZ.js";import"./circle-question-mark-DtC5Y68d.js";import"./star-C80gymXW.js";import"./message-circle-CLbYCCGy.js";import"./file-text-XKYnme41.js";import"./BackgroundArt-Ct9Pe-Iv.js";const M=({order:s,onClose:l})=>{if(!s)return null;const a=r=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN"}).format(parseFloat(r||0)),n=r=>r||e.jsx("span",{className:"text-gray-400 italic",children:"N/A"}),m=r=>{switch(r){case"paid":case"delivered":case"fulfilled":return"bg-green-100 text-green-700";case"pending":case"unfulfilled":return"bg-yellow-100 text-yellow-700";case"cancelled":case"failed":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white w-full max-w-5xl rounded-2xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden animate-in fade-in zoom-in duration-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 flex items-center justify-between bg-white sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-brand-50 text-brand-600 rounded-lg",children:e.jsx(k,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:s.order_number}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["ID: #",s.id]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(s.created_at).toLocaleString()})]})]})]}),e.jsx("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-full transition-colors text-gray-500",children:e.jsx(E,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 bg-gray-50/50",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Payment Status"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold capitalize ${m(s.payment_status)}`,children:s.payment_status})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Fulfillment"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold capitalize ${m(s.fulfillment_status)}`,children:s.fulfillment_status})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Order Status"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold capitalize ${m(s.order_status)}`,children:s.order_status})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-100 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Paid At"}),e.jsx("p",{className:"text-xs font-medium text-gray-900 truncate",title:s.paid_at,children:s.paid_at?new Date(s.paid_at).toLocaleDateString():"Not Paid"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-50 flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4 text-brand-600"}),"Shipping & Tracking Information"]}),s.shipment&&e.jsxs("span",{className:`text-xs px-2 py-1 rounded capitalize ${m(s.shipment.status)}`,children:["Shipment: ",s.shipment.status]})]}),e.jsxs("div",{className:"p-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Courier Service"}),e.jsx("p",{className:"font-medium text-gray-900",children:n(s.courier_name)}),e.jsxs("p",{className:"text-xs text-gray-400 font-mono mt-0.5",children:["Code: ",n(s.courier_code)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Tracking Number"}),e.jsx("p",{className:"font-medium text-gray-900 font-mono",children:n(s.tracking_number||s.shipment?.tracking_code)})]}),s.shipment?e.jsx("div",{className:"col-span-1 md:col-span-2 bg-blue-50 rounded-lg p-4 border border-blue-100",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs text-blue-600 font-semibold mb-1",children:["Shipment ID: ",s.shipment.shipment_id]}),e.jsxs("p",{className:"text-xs text-blue-800",children:["Created: ",new Date(s.shipment.created_at).toLocaleString()]})]}),s.shipment.tracking_url&&e.jsxs("a",{href:s.shipment.tracking_url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-xs bg-blue-600 text-white px-3 py-1.5 rounded-lg hover:bg-blue-700 transition-colors",children:["Track Shipment ",e.jsx(A,{className:"w-3 h-3"})]})]})}):e.jsxs("div",{className:"col-span-1 md:col-span-2 text-center py-4 bg-gray-50 rounded-lg border border-dashed border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"No shipment generated yet"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1 font-mono break-all px-4",children:["Request Token: ",n(s.shipping_request_token)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-50",children:e.jsxs("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-brand-600"}),"Order Items (",s.items?.length||0,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 font-medium text-gray-500",children:"Product"}),e.jsx("th",{className:"px-6 py-3 font-medium text-gray-500 text-center",children:"Qty"}),e.jsx("th",{className:"px-6 py-3 font-medium text-gray-500 text-right",children:"Unit Price"}),e.jsx("th",{className:"px-6 py-3 font-medium text-gray-500 text-right",children:"Total"}),e.jsx("th",{className:"px-6 py-3 font-medium text-gray-500 text-right",children:"Commission"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:s.items?.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded bg-gray-100 border border-gray-200 flex-shrink-0 overflow-hidden",children:e.jsx("img",{src:r.thumbnail,alt:r.name,className:"w-full h-full object-cover",onError:o=>o.target.src="https://placehold.co/100?text=No+Img"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:r.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Seller ID: ",r.seller_id]})]})]})}),e.jsx("td",{className:"px-6 py-4 text-center text-gray-900",children:r.quantity}),e.jsx("td",{className:"px-6 py-4 text-right text-gray-500",children:a(r.unit_price)}),e.jsx("td",{className:"px-6 py-4 text-right font-medium text-gray-900",children:a(r.total_price)}),e.jsxs("td",{className:"px-6 py-4 text-right",children:[e.jsxs("span",{className:"text-red-600 text-xs font-medium",children:["-",a(r.platform_commission_amount)]}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["(",r.platform_commission_rate,"%)"]})]})]},r.id))})]})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4 text-brand-600"}),"Customer Details"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 p-1.5 bg-gray-100 rounded-full",children:e.jsx(h,{className:"w-3 h-3 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:n(s.customer_fullname)}),e.jsxs("p",{className:"text-xs text-gray-500",children:["User ID: ",s.user_id]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 p-1.5 bg-gray-100 rounded-full",children:e.jsx(j,{className:"w-3 h-3 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:n(s.customer_phone)}),e.jsx("p",{className:"text-xs text-gray-500",children:"Contact Number"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5 p-1.5 bg-gray-100 rounded-full",children:e.jsx(F,{className:"w-3 h-3 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-900",children:n(s.customer_address)}),s.customer_address_2&&e.jsx("p",{className:"text-sm text-gray-900",children:s.customer_address_2}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:[s.customer_city,s.customer_state,s.customer_country].filter(Boolean).join(", ")})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-brand-600"}),"Financial Summary"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Total Amount"}),e.jsx("span",{className:"font-bold text-gray-900",children:a(s.total_amount)})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Shipping Cost"}),e.jsx("span",{className:"font-medium text-gray-900",children:a(s.shipping_amount)})]}),parseFloat(s.shipping_discount)>0&&e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Shipping Discount"}),e.jsxs("span",{className:"font-medium text-green-600",children:["-",a(s.shipping_discount)]})]}),e.jsx("div",{className:"border-t border-dashed border-gray-200 my-2"}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Platform Commission"}),e.jsxs("span",{className:"font-medium text-red-600",children:["-",a(s.total_commission)]})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg flex justify-between items-center mt-2 border border-green-100",children:[e.jsx("span",{className:"text-sm font-medium text-green-800",children:"Seller Earnings"}),e.jsx("span",{className:"text-lg font-bold text-green-800",children:a(s.total_seller_earnings)})]})]})]})]})]}),e.jsx("div",{className:"mt-8 pt-8 border-t border-gray-200",children:e.jsxs("details",{className:"group",children:[e.jsxs("summary",{className:"flex items-center gap-2 text-sm text-gray-500 cursor-pointer hover:text-gray-900 select-none w-fit",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:"View Raw Data (JSON)"})]}),e.jsx("div",{className:"mt-4 p-4 bg-slate-900 text-slate-300 rounded-lg overflow-x-auto text-xs font-mono shadow-inner",children:e.jsx("pre",{children:JSON.stringify(s,null,2)})})]})})]})]})})},q=async(s={})=>{try{return await p.get("/admin/orders",{query:s})}catch(l){throw console.error("Error fetching orders:",l),l}},R=async(s,l)=>{try{return await p.put(`/admin/orders/${s}`,{query:l})}catch(a){throw console.error("Error updating order payment status:",a),a}},U=async(s,l,a)=>{try{return await p.put(`/admin/orders/${s}/items/${l}/fulfillment`,{query:a})}catch(n){throw console.error("Error updating item fulfillment:",n),n}},V=async s=>{try{return await p.post(`/admin/orders/${s}/test-deliver`)}catch(l){throw console.error("Error marking order as delivered:",l),l}},B={getOrders:q,updateOrderPaymentStatus:R,updateItemFulfillment:U,testMarkOrderDelivered:V},he=()=>{const[s,l]=c.useState([]),[a,n]=c.useState(!0),[m,r]=c.useState(!1),[o,f]=c.useState(null),[b,g]=c.useState(!1),[u,N]=c.useState({page:1}),[i,w]=c.useState({current_page:1,last_page:1,total:0,per_page:20});c.useEffect(()=>{v()},[u.page]);const v=async()=>{try{n(!0);const t=await B.getOrders(u);let x=[],d={};t.data&&Array.isArray(t.data.data)?(x=t.data.data,d=t.data.meta||{}):t.data&&Array.isArray(t.data)||Array.isArray(t.data)?x=t.data:t.data?.data&&(x=t.data.data,d=t.data.meta||{}),l(x||[]),d&&Object.keys(d).length>0&&w({current_page:d.current_page||1,last_page:d.last_page||1,total:d.total||0,per_page:d.per_page||20})}catch(t){C("Failed to load orders"),console.error(t),l([])}finally{n(!1)}},_=t=>{f(t),g(!0)},y=t=>{t>=1&&t<=i.last_page&&N(x=>({...x,page:t}))},S=t=>{switch(t){case"paid":return"bg-green-100 text-green-700";case"pending":return"bg-yellow-100 text-yellow-700";case"failed":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}};return e.jsxs(D,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Order Management"}),e.jsx("p",{className:"text-gray-600",children:"Track and manage customer orders"})]}),e.jsxs("div",{className:"bg-white px-4 py-2 rounded-lg border border-gray-200 shadow-sm",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Total Orders: "}),e.jsx("span",{className:"font-semibold text-gray-900",children:i.total})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-500 uppercase",children:"Order Ref"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-500 uppercase",children:"Customer"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-500 uppercase",children:"Payment"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-500 uppercase",children:"Fulfillment"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-xs font-semibold text-gray-500 uppercase text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:a?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-8 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-600"})})})}):s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"px-6 py-8 text-center text-gray-500",children:"No orders found."})}):s.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.order_number}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",t.id]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-brand-50 flex items-center justify-center text-brand-600 font-medium text-xs",children:t.customer_fullname?.charAt(0)||e.jsx(h,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.customer_fullname}),e.jsx("p",{className:"text-xs text-gray-500",children:t.customer_phone})]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["₦",parseFloat(t.total_amount).toLocaleString()]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${S(t.payment_status)}`,children:t.payment_status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${t.fulfillment_status==="fulfilled"?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:t.fulfillment_status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:new Date(t.created_at).toLocaleDateString()})]})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>_(t),className:"p-2 hover:bg-gray-100 rounded-lg text-gray-500 transition-colors",title:"View Details",children:e.jsx(O,{className:"w-5 h-5"})})})]},t.id))})]})}),!a&&s.length>0&&e.jsxs("div",{className:"bg-gray-50 px-6 py-4 border-t border-gray-200 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Showing page ",i.current_page," of ",i.last_page]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(i.current_page-1),disabled:i.current_page===1,className:"p-2 border rounded-lg hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(i.current_page+1),disabled:i.current_page===i.last_page,className:"p-2 border rounded-lg hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(I,{className:"w-4 h-4"})})]})]})]}),b&&o&&e.jsx(M,{order:o,onClose:()=>g(!1)})]})};export{he as default};
