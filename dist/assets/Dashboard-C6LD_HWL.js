import{s as j,f as z,b as V,r as n,j as e,P as B,h as g,d as P}from"./index-BrJE6Ruv.js";import{D as q,S as p,a as M,P as F,E as G}from"./DashboardLayout-CbQpQ2VH.js";import{B as H}from"./Button-NP5qGopO.js";import{P as T}from"./x-89xIXrzd.js";import{U as J}from"./users-Btkg261Z.js";import{A as K}from"./arrow-up-right-C1ExLRe1.js";import{S as Q}from"./star-D0UWI2kz.js";import{C as A}from"./credit-card-De6BP3Px.js";import"./Logo-yv9J0Zw_.js";import"./house-B5NBqIRK.js";import"./createLucideIcon-DTbf89oH.js";import"./file-check-BlT-5aXD.js";import"./circle-question-mark-DdVU0ul4.js";import"./message-circle-CfRGLCSX.js";import"./file-text-DhmWdPlz.js";import"./info-D8IKXDkN.js";import"./user-BoLJHLaW.js";import"./BackgroundArt-Cv4ql44m.js";const X="https://agrimeet.udehcoglobalfoodsltd.com/api/v1",c=async(t,d={})=>{const r=j.getAccessToken();if(!r)throw new Error("Authentication token not found.");const o=await fetch(`${X}${t}`,{method:d.method||"GET",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json",Accept:"application/json",...d.headers},body:d.body||null});if(!o.ok){const x=await o.json().catch(()=>({message:"API request failed"}));throw new Error(x.message||`API request failed with status ${o.status}`)}return o.json()},Y=()=>c("/seller/vendor_stats"),Z=()=>c("/seller/top_weekly_products"),ee=()=>c("/seller/recent_weekly_orders"),se=()=>c("/seller/top_weekly_transactions"),te=t=>t?c(`/buyer/users/${t}`):Promise.reject(new Error("User ID is required to fetch profile.")),re=t=>c("/seller/kyc/validate-seller-address",{method:"POST",body:JSON.stringify({seller_id:t})}),f=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(t),ae=t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),C=t=>{switch(t?.toLowerCase()){case"paid":case"fulfilled":case"completed":return"bg-green-100 text-green-800";case"unpaid":case"unfulfilled":case"pending":return"bg-yellow-100 text-yellow-800";case"shipped":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},_e=()=>{const{user:t}=z(),d=V(),[r,o]=n.useState(null),[x,E]=n.useState([]),[y,L]=n.useState([]),[b,U]=n.useState([]),[I,$]=n.useState(!0),[i,O]=n.useState(()=>j.getUserData()),[u,N]=n.useState({stats:!0,products:!0,orders:!0,transactions:!0});console.log(i),n.useEffect(()=>{if(!t&&!i.user_id)return;const s=t.user_id||i.user_id||i.data.id;(async()=>{try{N(!0);const l=await te(s).catch(a=>(console.error("Error fetching user profile:",a),P("Could not refresh user profile."),null));if(!l||!l.data||!l.data.seller)throw new Error("Unable to retrieve seller details.");O(l),j.setUserData(l);const m=l.data.seller.id,[w,_,S,k]=await Promise.all([Y().catch(a=>(console.warn("Stats failed:",a),null)),Z(m).catch(a=>(console.warn("Products failed:",a),[])),ee(m).catch(a=>(console.warn("Orders failed:",a),[])),se(m).catch(a=>(console.warn("Transactions failed:",a),[]))]);w&&o(w),_&&E(_),S&&L(S),k&&U(k);const D=`addr_val_${m}`;if(!localStorage.getItem(D))try{await re(m),localStorage.setItem(D,"true"),console.log("Address validation synced successfully")}catch(a){console.warn("Address validation deferred:",a)}}catch(l){console.error("Critical Dashboard Error:",l),P(l.message||"An unexpected error occurred while loading.")}finally{N({stats:!1,products:!1,orders:!1,transactions:!1}),$(!1)}})()},[]);const R=[{title:"Total Revenue",value:r?f(r.total_revenue):"...",icon:q,color:"bg-green-500"},{title:"Total Products",value:r?r.total_products:"...",icon:T,color:"bg-brand-500"},{title:"Total Orders",value:r?r.total_orders:"...",icon:p,color:"bg-blue-500"},{title:"Total Reviews",value:r?r.total_reviews:"...",icon:J,color:"bg-purple-500"}];if(I)return e.jsx(B,{message:"Loading your dashboard..."});const W=i?.data?.first_name||t?.name||"User",h=i?.data?.seller?.store_name;return e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Welcome back, ",W,"!",h&&` Managing ${h}.`,!h&&" Here's what's happening with your agricultural business."]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:R.map((s,v)=>e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 p-6",children:[e.jsx("div",{className:`p-3 rounded-lg w-fit ml-auto ${s.color}`,children:e.jsx(s.icon,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:s.value})]})})]},v))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-xs border border-gray-100",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Weekly Orders"}),e.jsxs(H,{onClick:()=>d("/orders"),className:"text-brand-600 hover:text-brand-700 text-sm font-medium flex items-center gap-1",variant:"ghost",children:["View all ",e.jsx(K,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"p-6",children:u.orders?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(g,{size:"md",message:"Loading recent orders..."})}):y.length>0?e.jsx("div",{className:"space-y-4",children:y.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:s.products[0]?.thumbnail||"https://via.placeholder.com/40",alt:s.products[0]?.name,className:"w-10 h-10 object-cover rounded-lg bg-gray-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.order_number}),e.jsxs("p",{className:"text-sm text-gray-600",children:["by ",s.user.first_name," ",s.user.last_name]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:f(s.total_amount)}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-1",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${C(s.payment_status)}`,children:s.payment_status}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${C(s.fulfillment_status)}`,children:s.fulfillment_status})]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(p,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No recent orders this week."})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Top Products This Week"})}),e.jsx("div",{className:"p-6",children:u.products?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(g,{size:"md",message:"Loading top products..."})}):x.length>0?e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.product.thumbnail||"https://via.placeholder.com/40",alt:s.product.name,className:"w-10 h-10 object-cover rounded-lg bg-gray-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 truncate max-w-[150px]",children:s.product.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"w-3 h-3 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Top Seller"})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-semibold text-gray-900",children:[s.total_sold," sales"]})})]},s.product_id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No top products found this week."})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Top Weekly Transactions"})}),e.jsx("div",{className:"p-6",children:u.transactions?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(g,{size:"md",message:"Loading transactions..."})}):b.length>0?e.jsx("div",{className:"space-y-4",children:b.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(A,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.order_number}),e.jsxs("p",{className:"text-sm text-gray-600",children:["by ",s.user.first_name," ",s.user.last_name]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-green-600",children:f(s.total_amount)}),e.jsx("p",{className:"text-sm text-gray-500",children:ae(s.created_at)})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No transactions found this week."})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:()=>window.location.href="/products/add",className:"cursor-pointer flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"p-2 bg-brand-100 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Add Product"}),e.jsx("p",{className:"text-sm text-gray-600",children:"List a new agricultural product"})]})]}),e.jsxs("button",{onClick:()=>window.location.href="/products",className:"cursor-pointer flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(G,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"View Products"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage your product listings"})]})]}),e.jsxs("button",{onClick:()=>window.location.href="/orders",className:"cursor-pointer flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(p,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"View Orders"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Check order status and details"})]})]})]})]})]})})};export{_e as default};
