import{s as j,f as W,b as V,r as n,j as e,P as z,h as g,d as P}from"./index-C7G52Pl0.js";import{S as p,D as B,P as q,E as F}from"./DashboardLayout-BvYMyTkM.js";import{B as G}from"./Button-rTuh0BPh.js";import{P as T}from"./package-DupdcTls.js";import{U as H}from"./users-BmFRYmpR.js";import{A as J}from"./arrow-up-right-DZTMqIvy.js";import{S as K}from"./star-C80gymXW.js";import{C}from"./credit-card-DfSSP4nG.js";import"./Logo-DmsMbJO2.js";import"./x-B7cmv6PP.js";import"./createLucideIcon-BK9ndVRo.js";import"./house-D2YIMOjc.js";import"./file-check-CHEU1kxb.js";import"./shield-check-DG8ZUOrZ.js";import"./circle-question-mark-DtC5Y68d.js";import"./message-circle-CLbYCCGy.js";import"./file-text-XKYnme41.js";import"./user-CwMqLLM3.js";import"./BackgroundArt-Ct9Pe-Iv.js";const Q="https://agrimeetbackend.agrimeetconnect.com/api/v1",d=async(t,o={})=>{const r=j.getAccessToken();if(!r)throw new Error("Authentication token not found.");const i=await fetch(`${Q}${t}`,{method:o.method||"GET",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json",Accept:"application/json",...o.headers},body:o.body||null});if(!i.ok){const x=await i.json().catch(()=>({message:"API request failed"}));throw new Error(x.message||`API request failed with status ${i.status}`)}return i.json()},X=()=>d("/seller/vendor_stats"),Y=()=>d("/seller/top_weekly_products"),Z=()=>d("/seller/recent_weekly_orders"),ee=()=>d("/seller/top_weekly_transactions"),se=t=>t?d(`/buyer/users/${t}`):Promise.reject(new Error("User ID is required to fetch profile.")),te=t=>d("/seller/kyc/validate-seller-address",{method:"POST",body:JSON.stringify({seller_id:t})}),f=t=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",notation:"compact",maximumFractionDigits:1,minimumFractionDigits:0}).format(t),re=({size:t=24,color:o="currentColor",...r})=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...r,children:[e.jsx("path",{d:"M6 3v18"}),e.jsx("path",{d:"M18 3v18"}),e.jsx("path",{d:"M6 15l12-6"}),e.jsx("path",{d:"M6 11h12"}),e.jsx("path",{d:"M6 15h12"})]}),ae=t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),A=t=>{switch(t?.toLowerCase()){case"paid":case"fulfilled":case"completed":return"bg-green-100 text-green-800";case"unpaid":case"unfulfilled":case"pending":return"bg-yellow-100 text-yellow-800";case"shipped":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},ke=()=>{const{user:t}=W(),o=V(),[r,i]=n.useState(null),[x,L]=n.useState([]),[y,E]=n.useState([]),[b,I]=n.useState([]),[U,$]=n.useState(!0),[c,O]=n.useState(()=>j.getUserData()),[u,N]=n.useState({stats:!0,products:!0,orders:!0,transactions:!0});console.log(c),n.useEffect(()=>{if(!t&&!c.user_id)return;const s=t.user_id||c.user_id||c.data.id;(async()=>{try{N(!0);const l=await se(s).catch(a=>(console.error("Error fetching user profile:",a),P("Could not refresh user profile."),null));if(!l||!l.data||!l.data.seller)throw new Error("Unable to retrieve seller details.");O(l),j.setUserData(l);const m=l.data.seller.id,[w,_,k,S]=await Promise.all([X().catch(a=>(console.warn("Stats failed:",a),null)),Y(m).catch(a=>(console.warn("Products failed:",a),[])),Z(m).catch(a=>(console.warn("Orders failed:",a),[])),ee(m).catch(a=>(console.warn("Transactions failed:",a),[]))]);w&&i(w),_&&L(_),k&&E(k),S&&I(S);const D=`addr_val_${m}`;if(!localStorage.getItem(D))try{await te(m),localStorage.setItem(D,"true"),console.log("Address validation synced successfully")}catch(a){console.warn("Address validation deferred:",a)}}catch(l){console.error("Critical Dashboard Error:",l),P(l.message||"An unexpected error occurred while loading.")}finally{N({stats:!1,products:!1,orders:!1,transactions:!1}),$(!1)}})()},[]);const M=[{title:"Total Revenue",value:r?f(r.total_revenue):"...",icon:re,color:"bg-green-500"},{title:"Total Products",value:r?r.total_products:"...",icon:T,color:"bg-brand-500"},{title:"Total Orders",value:r?r.total_orders:"...",icon:p,color:"bg-blue-500"},{title:"Total Reviews",value:r?r.total_reviews:"...",icon:H,color:"bg-purple-500"}];if(U)return e.jsx(z,{message:"Loading your dashboard..."});const R=c?.data?.first_name||t?.name||"User",h=c?.data?.seller?.store_name;return e.jsx(B,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Welcome back, ",R,"!",h&&` Managing ${h}.`,!h&&" Here's what's happening with your agricultural business."]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:M.map((s,v)=>e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 p-6",children:[e.jsx("div",{className:`p-3 rounded-lg w-fit ml-auto ${s.color}`,children:e.jsx(s.icon,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:s.title}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:s.value})]})})]},v))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-xl shadow-xs border border-gray-100",children:[e.jsxs("div",{className:"p-6 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Recent Weekly Orders"}),e.jsxs(G,{onClick:()=>o("/orders"),className:"text-brand-600 hover:text-brand-700 text-sm font-medium flex items-center gap-1",variant:"ghost",children:["View all ",e.jsx(J,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"p-6",children:u.orders?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(g,{size:"md",message:"Loading recent orders..."})}):y.length>0?e.jsx("div",{className:"space-y-4",children:y.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:s.products[0]?.thumbnail||"https://via.placeholder.com/40",alt:s.products[0]?.name,className:"w-10 h-10 object-cover rounded-lg bg-gray-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.order_number}),e.jsxs("p",{className:"text-sm text-gray-600",children:["by ",s.user.first_name," ",s.user.last_name]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:f(s.total_amount)}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-1",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${A(s.payment_status)}`,children:s.payment_status}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium capitalize ${A(s.fulfillment_status)}`,children:s.fulfillment_status})]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(p,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No recent orders this week."})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Top Products This Week"})}),e.jsx("div",{className:"p-6",children:u.products?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(g,{size:"md",message:"Loading top products..."})}):x.length>0?e.jsx("div",{className:"space-y-4",children:x.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.product.thumbnail||"https://via.placeholder.com/40",alt:s.product.name,className:"w-10 h-10 object-cover rounded-lg bg-gray-100"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 truncate max-w-[150px]",children:s.product.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3 text-yellow-400 fill-current"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Top Seller"})]})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-semibold text-gray-900",children:[s.total_sold," sales"]})})]},s.product_id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No top products found this week."})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100",children:[e.jsx("div",{className:"p-6 border-b border-gray-100",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Top Weekly Transactions"})}),e.jsx("div",{className:"p-6",children:u.transactions?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(g,{size:"md",message:"Loading transactions..."})}):b.length>0?e.jsx("div",{className:"space-y-4",children:b.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(C,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.order_number}),e.jsxs("p",{className:"text-sm text-gray-600",children:["by ",s.user.first_name," ",s.user.last_name]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-semibold text-green-600",children:f(s.total_amount)}),e.jsx("p",{className:"text-sm text-gray-500",children:ae(s.created_at)})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(C,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No transactions found this week."})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:()=>window.location.href="/products/add",className:"cursor-pointer flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"p-2 bg-brand-100 rounded-lg",children:e.jsx(q,{className:"w-5 h-5 text-brand-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Add Product"}),e.jsx("p",{className:"text-sm text-gray-600",children:"List a new agricultural product"})]})]}),e.jsxs("button",{onClick:()=>window.location.href="/products",className:"cursor-pointer flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"View Products"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Manage your product listings"})]})]}),e.jsxs("button",{onClick:()=>window.location.href="/orders",className:"cursor-pointer flex items-center gap-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(p,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-gray-900",children:"View Orders"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Check order status and details"})]})]})]})]})]})})};export{ke as default};
