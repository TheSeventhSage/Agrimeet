import{b as $,s as K,r as n,d as h,j as e,k as J,e as Q}from"./index-BrJE6Ruv.js";import{a as S}from"./DashboardLayout-CbQpQ2VH.js";import{I as c}from"./Input-BSrsX0uX.js";import{S as x}from"./Select-BYKm0jtH.js";import{T as W}from"./Textarea-C0N1CgsT.js";import{B as N}from"./Button-NP5qGopO.js";import{D as _}from"./DocumentUpload-C7ZkA6yK.js";import{C as Y}from"./ConfirmationModal-CR03D5EN.js";import{a as z,b as H,c as V}from"./productsApi-DoagDVkF.js";import{g as X}from"./skuGenerator-CV7WoRSP.js";import{A as Z}from"./arrow-left-CT9Fk_P_.js";import{S as ee}from"./save-CUv4tCeF.js";import"./Logo-yv9J0Zw_.js";import"./x-89xIXrzd.js";import"./createLucideIcon-DTbf89oH.js";import"./house-B5NBqIRK.js";import"./users-Btkg261Z.js";import"./file-check-BlT-5aXD.js";import"./circle-question-mark-DdVU0ul4.js";import"./star-D0UWI2kz.js";import"./message-circle-CfRGLCSX.js";import"./file-text-DhmWdPlz.js";import"./info-D8IKXDkN.js";import"./user-BoLJHLaW.js";import"./BackgroundArt-Cv4ql44m.js";import"./trash-2-DWTUZwMs.js";const Pe=()=>{const m=$(),b=K.getUserData()?.data?.seller?.id,[a,q]=n.useState({name:"",sku:"",weight:"",slug:"",description:"",base_price:"",discount_price:"",stock_quantity:"",status:"active",category_id:"",unit_id:""}),[p,P]=n.useState([]),[u,D]=n.useState([]),[o,f]=n.useState({}),[y,j]=n.useState(!1),[k,g]=n.useState(!1),[I,E]=n.useState([]),[U,F]=n.useState([]),[O,v]=n.useState(!0);n.useEffect(()=>{A()},[]);const A=async()=>{try{v(!0);const[t,r]=await Promise.all([z(),H()]);E(t.data||[]),F(r.data||[])}catch(t){console.error("Error loading dependencies:",t),h("Failed to load form data")}finally{v(!1)}},i=t=>{const{name:r,value:l}=t.target;q(s=>{const d={...s,[r]:l};return r==="name"&&(d.sku=X(l)),d}),o[r]&&f(s=>({...s,[r]:""}))},B=t=>{P(t)},T=t=>{D(t)},G=()=>{const t={};return a.name.trim()||(t.name="Product name is required"),a.sku.trim()||(t.sku="SKU is required"),a.description.trim()||(t.description="Description is required"),a.base_price||(t.base_price="Base price is required"),a.stock_quantity||(t.stock_quantity="Stock quantity is required"),a.category_id||(t.category_id="Category is required"),a.unit_id||(t.unit_id="Unit is required"),p.length===0&&u.length===0&&(t.images="At least one image or thumbnail is required"),f(t),Object.keys(t).length===0},C=(t,r=0)=>{let l=[];return t&&t.forEach(s=>{const d=r>0?"  ".repeat(r)+"- ":"";l.push({value:String(s.id),label:`${d}${s.name}`}),s.children&&s.children.length>0&&(l=[...l,...C(s.children,r+1)])}),l},L=C(I),M=async t=>{if(t.preventDefault(),!G()){h("Please fix the errors in the form");return}j(!0);try{const r=new FormData;if(b&&r.append("seller_id",b),Object.keys(a).forEach(s=>{a[s]!==""&&a[s]!==null&&r.append(s,a[s])}),p.forEach(s=>{const d=s.file||s;r.append("images[]",d)}),u.length>0){const s=u[0].file||u[0];r.append("thumbnail",s)}const l=await V(r);Q("Product created successfully!"),m("/products")}catch(r){console.error("Error creating product:",r),h(r.message||"Failed to create product")}finally{j(!1)}},w=()=>{Object.values(a).some(r=>r!==""&&r!=="active")||p.length>0?g(!0):m("/products")},R=()=>{g(!1),m("/products")};return O?e.jsx(S,{children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(J,{}),e.jsx("p",{className:"text-gray-600 ml-3",children:"Loading form data..."})]})})}):e.jsx(S,{children:e.jsxs("div",{className:"max-w-4xl mx-auto pb-12",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("button",{onClick:w,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors mr-4",children:e.jsx(Z,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Add New Product"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Create a new product listing"})]})]})}),e.jsxs("form",{onSubmit:M,className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:"Product Name",name:"name",value:a.name,onChange:i,placeholder:"e.g., Organic Bananas",error:o.name,required:!0}),e.jsx(c,{label:"SKU",name:"sku",value:a.sku,onChange:i,placeholder:"e.g. PROD-001",error:o.sku,required:!0}),e.jsx(c,{label:"Slug (Optional)",name:"slug",value:a.slug,onChange:i,placeholder:"Auto-generated if empty"}),e.jsx(x,{label:"Category",name:"category_id",value:a.category_id,onChange:i,options:L,placeholder:"Select category",error:o.category_id,required:!0}),e.jsx(c,{label:"Stock Quantity",name:"stock_quantity",type:"number",value:a.stock_quantity,onChange:i,placeholder:"0",error:o.stock_quantity,required:!0,min:"0"}),e.jsx(x,{label:"Unit",name:"unit_id",value:a.unit_id,onChange:i,options:U.map(t=>({value:String(t.id),label:`${t.name} (${t.symbol})`})),placeholder:"Select unit",error:o.unit_id,required:!0}),e.jsx(x,{label:"Status",name:"status",value:a.status,onChange:i,options:[{value:"active",label:"Active"},{value:"draft",label:"Draft"},{value:"inactive",label:"Inactive"}],required:!0}),e.jsx(c,{label:"Weight",name:"weight",type:"number",value:a.weight,onChange:i,placeholder:"Enter weight (e.g. 0.5)",error:o.weight,min:"0",step:"0.01"})]}),e.jsx("div",{className:"mt-6",children:e.jsx(W,{label:"Description",name:"description",value:a.description,onChange:i,placeholder:"Describe your product...",error:o.description,required:!0,rows:4})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Pricing"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:"Base Price",name:"base_price",type:"number",value:a.base_price,onChange:i,placeholder:"0.00",error:o.base_price,required:!0,min:"0",step:"0.01"}),e.jsx(c,{label:"Discount Price (Optional)",name:"discount_price",type:"number",value:a.discount_price,onChange:i,placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Product Images"}),e.jsx(_,{label:"Product Thumbnail (Required)",onChange:T,error:o.images,multiple:!1,maxFiles:1,helperText:"PNG, JPG, GIF up to 10MB"}),e.jsx(_,{label:"Gallery Images",onChange:B,multiple:!0,maxFiles:5,helperText:"PNG, JPG, GIF up to 10MB each"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-4",children:[e.jsx(N,{type:"button",onClick:w,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs(N,{type:"submit",loading:y,className:"px-6 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),y?"Creating...":"Create Product"]})]})]}),e.jsx(Y,{isOpen:k,onClose:()=>g(!1),onConfirm:R,title:"Cancel Product Creation",message:"You have unsaved changes. Are you sure you want to leave? All your progress will be lost.",confirmText:"Leave",cancelText:"Continue Editing",type:"warning"})]})})};export{Pe as default};
