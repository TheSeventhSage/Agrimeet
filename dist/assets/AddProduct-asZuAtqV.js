import{b as $,s as K,r as n,d as h,j as e,k as J,e as Q}from"./index-BOLkSH9S.js";import{D as S}from"./DashboardLayout-BvCakflT.js";import{I as c}from"./Input-gDbNO7ZY.js";import{S as x}from"./Select-BjKnig4G.js";import{T as W}from"./Textarea-BF2rmwwI.js";import{B as N}from"./Button-DPYyXRjf.js";import{D as _}from"./DocumentUpload-B5v2JEUP.js";import{C as Y}from"./ConfirmationModal-cvEjaG2Q.js";import{a as z,b as H,c as V}from"./productsApi-Binhdwhq.js";import{g as X}from"./skuGenerator-CV7WoRSP.js";import{A as Z}from"./arrow-left-Cgff3Zyj.js";import{S as ee}from"./save-C2XOQisP.js";import"./Logo-g0xKsfJ_.js";import"./x-C2LEswAj.js";import"./createLucideIcon-Df3o3GTg.js";import"./package-CKJSu7qp.js";import"./house-CbQ0kLy2.js";import"./users-B4SWA-Gw.js";import"./file-check-CwXOnyIx.js";import"./shield-check-BosUqYmL.js";import"./circle-question-mark-CVrBAAd0.js";import"./star-C1ESBnNj.js";import"./message-circle-BHYE61eq.js";import"./file-text-CticlOFV.js";import"./user-CozA4sKy.js";import"./BackgroundArt-ChQV54k0.js";import"./trash-2-Euhy1XCH.js";const Pe=()=>{const m=$(),b=K.getUserData()?.data?.seller?.id,[r,q]=n.useState({name:"",sku:"",weight:"",slug:"",description:"",base_price:"",discount_price:"",stock_quantity:"",status:"active",category_id:"",unit_id:""}),[p,D]=n.useState([]),[u,P]=n.useState([]),[o,f]=n.useState({}),[y,j]=n.useState(!1),[k,g]=n.useState(!1),[I,E]=n.useState([]),[U,F]=n.useState([]),[O,v]=n.useState(!0);n.useEffect(()=>{A()},[]);const A=async()=>{try{v(!0);const[t,a]=await Promise.all([z(),H()]);E(t.data||[]),F(a.data||[])}catch(t){console.error("Error loading dependencies:",t),h("Failed to load form data")}finally{v(!1)}},i=t=>{const{name:a,value:l}=t.target;q(s=>{const d={...s,[a]:l};return a==="name"&&(d.sku=X(l)),d}),o[a]&&f(s=>({...s,[a]:""}))},B=t=>{D(t)},T=t=>{P(t)},G=()=>{const t={};return r.name.trim()||(t.name="Product name is required"),r.sku.trim()||(t.sku="SKU is required"),r.description.trim()||(t.description="Description is required"),r.base_price||(t.base_price="Base price is required"),r.stock_quantity||(t.stock_quantity="Stock quantity is required"),r.category_id||(t.category_id="Category is required"),r.unit_id||(t.unit_id="Unit is required"),p.length===0&&u.length===0&&(t.images="At least one image or thumbnail is required"),f(t),Object.keys(t).length===0},C=(t,a=0)=>{let l=[];return t&&t.forEach(s=>{const d=a>0?"  ".repeat(a)+"- ":"";l.push({value:String(s.id),label:`${d}${s.name}`}),s.children&&s.children.length>0&&(l=[...l,...C(s.children,a+1)])}),l},L=C(I),M=async t=>{if(t.preventDefault(),!G()){h("Please fix the errors in the form");return}j(!0);try{const a=new FormData;if(b&&a.append("seller_id",b),Object.keys(r).forEach(s=>{r[s]!==""&&r[s]!==null&&a.append(s,r[s])}),p.forEach(s=>{const d=s.file||s;a.append("images[]",d)}),u.length>0){const s=u[0].file||u[0];a.append("thumbnail",s)}const l=await V(a);Q("Product created successfully!"),m("/products")}catch(a){console.error("Error creating product:",a),h(a.message||"Failed to create product")}finally{j(!1)}},w=()=>{Object.values(r).some(a=>a!==""&&a!=="active")||p.length>0?g(!0):m("/products")},R=()=>{g(!1),m("/products")};return O?e.jsx(S,{children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(J,{}),e.jsx("p",{className:"text-gray-600 ml-3",children:"Loading form data..."})]})})}):e.jsx(S,{children:e.jsxs("div",{className:"max-w-4xl mx-auto pb-12",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("button",{onClick:w,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors mr-4",children:e.jsx(Z,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Add New Product"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Create a new product listing"})]})]})}),e.jsxs("form",{onSubmit:M,className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:"Product Name",name:"name",value:r.name,onChange:i,placeholder:"e.g., Organic Bananas",error:o.name,required:!0}),e.jsx(c,{label:"SKU",name:"sku",value:r.sku,onChange:i,placeholder:"e.g. PROD-001",error:o.sku,required:!0}),e.jsx(c,{label:"Slug (Optional)",name:"slug",value:r.slug,onChange:i,placeholder:"Auto-generated if empty"}),e.jsx(x,{label:"Category",name:"category_id",value:r.category_id,onChange:i,options:L,placeholder:"Select category",error:o.category_id,required:!0}),e.jsx(c,{label:"Stock Quantity",name:"stock_quantity",type:"number",value:r.stock_quantity,onChange:i,placeholder:"0",error:o.stock_quantity,required:!0,min:"0"}),e.jsx(x,{label:"Unit",name:"unit_id",value:r.unit_id,onChange:i,options:U.map(t=>({value:String(t.id),label:`${t.name} (${t.symbol})`})),placeholder:"Select unit",error:o.unit_id,required:!0}),e.jsx(x,{label:"Status",name:"status",value:r.status,onChange:i,options:[{value:"active",label:"Active"},{value:"draft",label:"Draft"},{value:"inactive",label:"Inactive"}],required:!0}),e.jsx(c,{label:"Weight",name:"weight",type:"number",value:r.weight,onChange:i,placeholder:"Enter weight (e.g. 0.5)",error:o.weight,min:"0",step:"0.01"})]}),e.jsx("div",{className:"mt-6",children:e.jsx(W,{label:"Description",name:"description",value:r.description,onChange:i,placeholder:"Describe your product...",error:o.description,required:!0,rows:4})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Pricing"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:"Base Price",name:"base_price",type:"number",value:r.base_price,onChange:i,placeholder:"0.00",error:o.base_price,required:!0,min:"0",step:"0.01"}),e.jsx(c,{label:"Discount Price (Optional)",name:"discount_price",type:"number",value:r.discount_price,onChange:i,placeholder:"0.00",min:"0",step:"0.01"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Product Images"}),e.jsx(_,{label:"Product Thumbnail (Required)",onChange:T,error:o.images,multiple:!1,maxFiles:1,helperText:"PNG, JPG, GIF up to 10MB"}),e.jsx(_,{label:"Gallery Images",onChange:B,multiple:!0,maxFiles:5,helperText:"PNG, JPG, GIF up to 10MB each"})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-4",children:[e.jsx(N,{type:"button",onClick:w,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs(N,{type:"submit",loading:y,className:"px-6 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),y?"Creating...":"Create Product"]})]})]}),e.jsx(Y,{isOpen:k,onClose:()=>g(!1),onConfirm:R,title:"Cancel Product Creation",message:"You have unsaved changes. Are you sure you want to leave? All your progress will be lost.",confirmText:"Leave",cancelText:"Continue Editing",type:"warning"})]})})};export{Pe as default};
