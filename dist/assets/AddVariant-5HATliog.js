import{a as R,b as T,r as n,d as p,j as e,k as F,e as $}from"./index-BrJE6Ruv.js";import{a as S}from"./DashboardLayout-CbQpQ2VH.js";import{I as u}from"./Input-BSrsX0uX.js";import{S as _}from"./Select-BYKm0jtH.js";import{B as N}from"./Button-NP5qGopO.js";import{C as B}from"./ConfirmationModal-CR03D5EN.js";import{b as K,e as M,f as O}from"./productsApi-DoagDVkF.js";import{g as z}from"./skuGenerator-CV7WoRSP.js";import{A as G}from"./arrow-left-CT9Fk_P_.js";import{S as H}from"./save-CUv4tCeF.js";import"./Logo-yv9J0Zw_.js";import"./x-89xIXrzd.js";import"./createLucideIcon-DTbf89oH.js";import"./house-B5NBqIRK.js";import"./users-Btkg261Z.js";import"./file-check-BlT-5aXD.js";import"./circle-question-mark-DdVU0ul4.js";import"./star-D0UWI2kz.js";import"./message-circle-CfRGLCSX.js";import"./file-text-DhmWdPlz.js";import"./info-D8IKXDkN.js";import"./user-BoLJHLaW.js";import"./BackgroundArt-Cv4ql44m.js";const be=()=>{const{productId:d}=R(),l=T(),[s,C]=n.useState({name:"",sku:"",price:"",stock_quantity:"",unit_id:""}),[m,k]=n.useState([{attribute_id:"",value:""}]),[o,h]=n.useState({}),[x,b]=n.useState(!1),[q,g]=n.useState(!1),[w,A]=n.useState([]),[D,E]=n.useState([]),[V,f]=n.useState(!0);n.useEffect(()=>{if(!d){p("Invalid product ID"),l("/products");return}I()},[d,l]);const I=async()=>{try{f(!0);const[t,a]=await Promise.all([K(),M()]);A(t.data||[]);const r=a.data||a;E(Array.isArray(r)?r:[r])}catch(t){console.error("Error loading form data:",t),p("Failed to load form data. Please refresh.")}finally{f(!1)}},c=t=>{const{name:a,value:r}=t.target;C(i=>{const j={...i,[a]:r};return a==="name"&&(j.sku=z(r)),j}),o[a]&&h(i=>({...i,[a]:""}))},y=(t,a,r)=>{const i=[...m];i[t][a]=r,k(i)},L=()=>{const t={};return s.name.trim()||(t.name="Variety name is required"),s.sku.trim()||(t.sku="SKU is required"),(!s.price||s.price<=0)&&(t.price="Valid price is required"),(!s.stock_quantity||s.stock_quantity<0)&&(t.stock_quantity="Valid stock quantity is required"),s.unit_id||(t.unit_id="Unit is required"),m.forEach((a,r)=>{a.attribute_id.trim()||(t[`attribute_${r}_id`]="Attribute ID is required"),a.value.trim()||(t[`attribute_${r}_value`]="Attribute value is required")}),h(t),Object.keys(t).length===0},P=async t=>{if(t.preventDefault(),!!L()){b(!0);try{const a={...s,attributeValues:m.map(i=>({attribute_id:parseInt(i.attribute_id),value:i.value}))},r=await O(d,a);$(r.message||"Variety created successfully!"),l("/products")}catch(a){console.error("Error creating variety:",a),a.message.includes("Session expired")?(p("Session expired. Please login again."),l("/login")):p(a.message||"Error creating variety. Please try again.")}finally{b(!1)}}},v=()=>{s.name||s.sku||s.price||s.stock_quantity||s.unit_id?g(!0):l("/products")},U=()=>{g(!1),l("/products")};return V?e.jsx(S,{children:e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(F,{}),e.jsx("p",{className:"text-gray-600",children:"Loading form data..."})]})})})}):e.jsx(S,{children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("button",{onClick:v,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(G,{className:"w-5 h-5 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Add Product Varieties"}),e.jsxs("p",{className:"text-gray-600",children:["Create a new variety for product ID: ",d]})]})]})}),e.jsxs("form",{onSubmit:P,className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Variety Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(u,{label:"Variety Name",name:"name",value:s.name,onChange:c,placeholder:"e.g., Large Red T-Shirt",error:o.name,required:!0}),e.jsx(u,{label:"SKU",name:"sku",value:s.sku,onChange:c,placeholder:"e.g., TSH-LRG-RED-001",error:o.sku,required:!0}),e.jsx(u,{label:"Price",name:"price",type:"number",value:s.price,onChange:c,placeholder:"Enter price",error:o.price,required:!0,min:"0",step:"0.01"}),e.jsx(u,{label:"Stock Quantity",name:"stock_quantity",type:"number",value:s.stock_quantity,onChange:c,placeholder:"Enter stock quantity",error:o.stock_quantity,required:!0,min:"0"}),e.jsx(_,{label:"Unit",name:"unit_id",value:s.unit_id,onChange:c,options:w.map(t=>({value:t.id,label:t.name})),placeholder:"Select unit",error:o.unit_id,required:!0})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-xs border border-gray-100 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Attributes"})}),e.jsx("div",{className:"space-y-4",children:m.map((t,a)=>e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("div",{className:"flex-1",children:e.jsx(_,{label:"Attribute Type",value:t.attribute_id,onChange:r=>y(a,"attribute_id",r.target.value),options:D.map(r=>({value:String(r.id),label:r.name})),placeholder:"Select Attribute (e.g. Size)",error:o[`attribute_${a}_id`],required:!0})}),e.jsx("div",{className:"flex-1",children:e.jsx(u,{label:"Value",value:t.value,onChange:r=>y(a,"value",r.target.value),placeholder:"e.g., Large",error:o[`attribute_${a}_value`],required:!0})})]},a))})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-6 border-t border-gray-200",children:[e.jsx(N,{type:"button",onClick:v,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsxs(N,{type:"submit",loading:x,className:"px-6 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 transition-colors flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),x?"Creating...":"Create Variety"]})]})]}),e.jsx(B,{isOpen:q,onClose:()=>g(!1),onConfirm:U,title:"Cancel Variety Creation",message:"You have unsaved changes. Are you sure you want to leave?",confirmText:"Leave",cancelText:"Continue Editing",type:"warning"})]})})};export{be as default};
